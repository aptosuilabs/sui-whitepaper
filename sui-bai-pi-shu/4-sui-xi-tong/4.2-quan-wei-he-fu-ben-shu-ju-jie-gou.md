# 4.2 权威和副本数据结构

隋当局依靠许多数据结构来表示状态。 我们根据它们支持的操作来定义这些结构。 它们都具有确定性的字节表示。

* 一个对象（Obj）在 Sui 中存储用户智能合约和数据。 它们是 Sect 中介绍的 Move 对象的 Sui 系统级编码。 2. 它们支持以下一组操作：
* _ref_(Obj) returns the _reference_ (ObjRef) of the object, namely a triplet (ObjID, Version, ObjDigest). ObjID is practically

![](../../.gitbook/assets/0)

图 1：提交事务的交互概述。 对所有创建的新对象都是唯一的，而 Version 是一个递增的正整数，表示对象版本在发生变异时。

• owner(Obj) 返回对象所有者的认证者Auth。 在最简单的情况下，Auth 是一个地址，代表一个可以使用该对象的公钥。 还可以使用更复杂的身份验证器（参见第 4.4 节）。

• 如果对象是只读的，read-only(Obj) 返回真。 只读对象可能永远不会被变异、包装或删除。 它们也可能被任何人使用，而不仅仅是它们的所有者。

• parent(Obj) 返回上次改变或创建对象的事务摘要 (TxDigest)。

• contents(Obj) 返回对象类型 类型和数据 可用于检查交易有效性和携带对象的应用程序特定信息的数据。

对象引用 (ObjRef) 用于索引对象。它还用于验证对象，因为 ObjDigest 是对其全部内容的承诺。

事务 (Tx) 是一种结构，表示一个或多个对象的状态转换。它们支持以下一组操作：

• digest(Tx) 返回TxDigest，它是对交易的绑定加密承诺。

• epoch(Tx) 返回可以执行此事务的 EpochID。

• inputs(Tx) 返回事务需要执行的一系列对象\[ObjRef]。

• payment(Tx) 返回对用于支付gas 的ObjRef 的引用，以及最大gas 限制，以及gas 单位与gas 支付对象中的价值单位之间的转换率。

• 如果交易有效，valid(Tx, \[Obj]) 返回真，给定请求的输入对象。有效性在 Sect 中讨论。 4.4，并涉及授权对输入对象进行操作的交易，以及有足够的可用gas来支付其执行成本。

• exec(Tx, \[Obj]) 执行事务并返回表示其效果的结构Effects。有效的交易执行是绝对可靠的，其输出是确定性的。

交易由其 TxDigest 索引，也可用于验证其全部内容。所有有效的交易（除了特殊的硬编码创世交易）都有至少一个拥有的输入，即用于支付 gas 的对象。

交易效果（Effects）结构总结了交易执行的结果。它支持以下操作：

• digest(Effects) 是对Effects 结构的承诺EffDigest，可用于索引或验证它。

• transaction(Effects) 返回产生效果的已执行交易的 TxDigest。

• dependencies(Effects) 返回一系列依赖项\[TxDigest]，应该在具有这些效果的事务执行之前执行。

• contents(Effects) 返回执行摘要。状态报告智能合约执行的结果。 Created、Mutated、Wrapped、Unwrapped 和 Deleted 列表列出了进行了相应的操作。 Events 列出了执行发出的事件。

交易上的交易证书 TxCert 包含交易本身以及来自法定人数的标识符和签名。请注意，证书可能不是唯一的，因为相同的逻辑证书可能由形成法定人数的不同权限集表示。此外，证书可能不会严格由 2/3 的法定人数签署，但如果有更多的权威机构响应，则可能更多。但是，同一事务中的两个不同的有效证书应被视为在语义上表示相同的证书。部分证书 (TxSign) 包含相同的信息，但来自一组代表权益的机构的签名低于所需的法定人数，通常是单个机构。签名者的标识符包含在证书中（即负责的签名 \[? ]），以识别准备处理证书的机构，或者可用于下载处理证书所需的过去信息（参见第 4.8 节）。

类似地，效果结构上的效果证书 EffCert 包含效果结构本身，以及代表交易有效时期法定人数的权威机构的签名。关于非唯一性和身份的相同警告适用于交易证书。部分效果证书，通常包含单个授权签名，效果结构表示为 EffSign。

持久存储。每个权限和副本都维护一组持久存储。存储实现持久映射语义，可以表示为一组键值对（表示为

𝑚𝑎𝑝\[𝑘𝑒𝑦] → 𝑣𝑎𝑙𝑢𝑒），这样只有一对有给定的密钥。在插入一对之前， contains(𝑘𝑒𝑦) 调用返回 false，而 get(𝑘𝑒𝑦) 返回错误。插入一对之后， contains(𝑘𝑒𝑦) 调用返回 true，get(𝑘𝑒𝑦) 返回值。权限维护以下持久性存储：

• 订单锁映射 Lock𝑣 \[ObjRef] → TxSignOption 记录由权威机构为拥有的对象版本 ObjRef 看到并签名的第一个有效交易 Tx，或者如果对象版本存在但没有有效交易用作输入，则记录为无。它还可以记录与该对象一起看到的第一个证书作为输入。该表及其更新规则表示跨 Sui 权限的对象分布式锁的状态，并确保事务并发处理下的安全性。

• 证书映射 Ct𝑣 \[TxDigest] → (TxCert, EffSign) 记录所有完整证书 TxCert，其中还包括 Tx，由权威机构在其有效期内处理，以及它们的签名效果 EffSign。它们由交易摘要 TxDigest 索引

• 对象映射 Obj𝑣 \[ObjRef] → Obj 记录由 Ct𝑣 内证书中包含的事务创建的所有对象 Obj由 ObjRef 索引。通过重新执行 Ct𝑣 中的所有证书，可以完全导出此存储。维护一个二级索引，将 ObjID 映射到具有此 ID 的最新对象。这是处理新事务所需的唯一信息，维护旧版本只是为了方便读取和审计。

• 同步映射 Sync𝑣 \[ObjRef] → TxDigest 索引 Ct𝑣 内的所有证书，按它们创建、变异或删除的对象作为元组 ObjRef。通过处理 Ct𝑣 中的所有证书可以完全重新创建此结构，并用于帮助客户端同步影响他们关心的对象的事务。

权威机构维护所有四个结构，并提供对其证书映射的本地检查点的访问权限，以允许其他权威机构和副本下载其完整的已处理证书集。副本不处理事务而只处理证书，并像当局一样重新执行它们以更新其他表。它还维护一个订单锁映射以审计非模棱两可。

权限可以设计为维护所有四个存储（和检查点）以促进读取和同步的完整副本，并结合最小权限核心，该核心仅维护用于处理新事务和证书的最新版本对象的对象锁和对象。这最大限度地减少了安全所依赖的可信计算库。

只有顺序锁映射需要强键自一致性，即对键的读取应始终返回是否存在值或 None 对于存在的键，并且这种检查应该是原子的，并且更新将锁定设置为非无值。这是一个比键之间的强一致性更弱的属性，并且允许对存储进行有效的分片以进行扩展。其他商店可能最终一致而不影响安全。
