# 3.5 交易

| ObjRef =     | ObjID × Version × _𝐶𝑜𝑚_(Obj)                   |
| ------------ | ------------------------------------------------- |
| CallTarget = | ObjRef × ModuleName × FunName                     |
| CallArg =    | ObjRef ⊎ ObjID ⊎ PrimType                         |
| Package =    | \[Module]                                         |
| Publish =    | Package × \[ObjRef]                               |
| Call =       | CallTarget × \[StorableType] × \[CallArg]         |
| GasInfo =    | ObjRef × MaxGas × BaseFee × Tip                   |
| Tx =         | (Call ⊎ Publish) × GasInfo × Addr × Authenticator |

表 5：交易

Sui 有两种不同的事务类型：发布新的 Move 包和调用之前发布的 Move 包。发布事务包含一个包——一组将作为单个对象一起发布的模块，以及此包中所有模块的依赖关系（编码为对象引用列表，必须引用已发布的包对象）。为了执行发布事务，Sui 运行时将在每个包上运行移动字节码验证器，将包与其依赖项链接起来，并运行每个模块的模块初始化程序。模块初始化器对于引导由包实现的应用程序的初始状态很有用。

调用事务最重要的参数是对象输入。对象参数可以通过对象引用（对于单一所有者和共享的不可变对象）或对象 ID（对于共享可变对象）。对象引用由对象 ID、对象版本和对象值的散列组成。 Sui 运行时会将对象 ID 和对象引用解析为存储在全局对象池中的对象值。对于对象引用，运行时将根据池中对象的版本检查引用的版本，并检查引用的哈希是否与池对象匹配。这确保了运行时对象的视图与事务发送者的对象视图相匹配。

此外，调用事务接受类型参数和纯值参数。类型参数实例化要调用的入口点函数的泛型类型参数（例如，如果入口点函数是 send\_coin\<T>(c: Coin\<T>, ...)，则可以使用类型参数来实例化泛型类型参数 T SUI 发送 Sui 原生令牌）。纯值可以包括原始类型和原始类型的向量，但不包括结构类型。

调用要调用的函数通过对象引用（必须引用包对象）、该包中的模块名称和该包中的函数名称来指定。为了执行调用事务，Sui 运行时将解析函数，将类型、对象和值参数绑定到函数参数，并使用 Move VM 执行函数。

调用和发布交易均需支付燃气计量和燃气费。 计量限制由最大气体预算表示。 运行时将执行事务，直到达到预算，如果预算用尽，将中止（除了扣除费用和报告中止代码）。

费用从指定为对象参考的气体对象中扣除。 该对象必须是 Sui 原生令牌（即，其类型必须是 Coin\<SUI>）。 Sui 使用 EIP1559 式的费用：协议定义了一个基本费用（以每个 Sui 代币的 gas 单位计价），该费用在 epoch 边界通过算法进行调整，并且交易发送者还可以包括一个可选的小费（以 Sui 代币计价）。 在正常系统负载下，即使没有小费，交易也会得到及时处理。 但是，如果系统拥塞，小费较大的交易将被优先处理。 从 gas 对象中扣除的总费用为 (GasUsed ∗ BaseFee) + Tip。
